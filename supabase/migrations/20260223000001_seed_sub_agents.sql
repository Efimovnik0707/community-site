INSERT INTO comm_content_items (slug, title, description, type, tool, content_body, is_premium, tags, sort_order, published) VALUES (
  'sub-agents-delegirovanie-zadach',
  'Sub-agents: делегируй задачи внутри Claude Code',
  'Подагенты в Claude Code: как разгрузить контекст, ускорить работу и экономить токены через делегирование задач отдельным агентам.',
  'skill',
  'claude-code',
  $body$
<h2>Проблема длинных сессий</h2>

<p>У Claude Code есть контекстное окно. Это объём информации, который модель удерживает "в голове" одновременно. Представь рабочий стол: чем больше на нём бумаг, тем сложнее найти нужную.</p>

<p>После 50-100 обменов в одной сессии качество ответов падает. Claude Code начинает "забывать" инструкции из начала разговора, путает имена файлов, повторяет уже сделанное. Расход токенов при этом растёт экспоненциально: каждое новое сообщение включает всю предыдущую историю.</p>

<p><strong>Типичная ошибка:</strong> одна сессия на весь день работы. К вечеру модель работает хуже, чем утром, и стоит в разы дороже.</p>

<h2>Что такое sub-agents</h2>

<p>Sub-agent (подагент). Это отдельная мини-сессия, которую Claude Code запускает внутри основной. У подагента свой контекст, свой системный промпт, свои инструменты. Он выполняет задачу и возвращает только результат. Промежуточные шаги не попадают в основную сессию.</p>

<p>Аналогия: ты руководитель. Вместо того чтобы самому искать информацию, ты отправляешь помощника. Он возвращается с ответом. Твой рабочий стол остаётся чистым.</p>

<p>Claude Code использует подагентов через <strong>Task tool</strong>. Типы задач, которые он делегирует:</p>
<ul>
  <li><strong>Поиск по кодовой базе</strong> (Explore agent). Сканирует файлы, не раздувая основной контекст</li>
  <li><strong>Параллельные операции.</strong> Несколько файлов редактируются одновременно через разных агентов</li>
  <li><strong>Планирование.</strong> Отдельный агент анализирует задачу и предлагает план</li>
  <li><strong>Исследование.</strong> Агент читает документацию, код, зависимости и возвращает сводку</li>
</ul>

<h2>Как заставить Claude Code делегировать</h2>

<p>Claude Code сам решает, когда запускать подагента. Но ты можешь повлиять на это через <strong>CLAUDE.md</strong>. Добавь правила делегирования:</p>

<pre><code># Правила делегирования

## Поиск и исследование
- Для поиска по кодовой базе используй Task agent. Не ищи напрямую в основной сессии, если нужно проверить больше 5 файлов.
- Для исследования архитектуры или зависимостей используй отдельного агента и верни сводку.

## Параллельные задачи
- Если задача включает изменения в 3+ независимых файлах, запускай агентов параллельно.

## Защита контекста
- Тяжёлый анализ (чтение больших файлов, сравнение реализаций) делегируй подагенту.
- В основной сессии работай только с результатами, не с сырыми данными.</code></pre>

<h2>Практические паттерны</h2>

<h3>Паттерн "Исследователь"</h3>
<p>Отдельный агент получает задачу: изучить часть кодовой базы и вернуть структурированный отчёт. Основная сессия получает только итог.</p>
<p><strong>Что написать Claude Code:</strong></p>
<pre><code>Исследуй, как реализована аутентификация в проекте.
Найди все файлы, связанные с auth, определи flow
(регистрация, логин, сессии), верни краткую сводку
с путями к ключевым файлам.</code></pre>
<p>Claude Code запустит Task agent, который прочитает десятки файлов. В основную сессию вернётся только сводка на 10-15 строк.</p>

<h3>Паттерн "Параллельные задачи"</h3>
<p>Несколько независимых изменений выполняются одновременно. Каждый агент работает со своим файлом.</p>
<p><strong>Что написать Claude Code:</strong></p>
<pre><code>Обнови все три компонента одновременно:
1. Header.tsx: добавь мобильное меню
2. Footer.tsx: добавь ссылки на соцсети
3. Sidebar.tsx: добавь состояние collapsed
Каждый компонент меняй независимо.</code></pre>

<h3>Паттерн "Защита контекста"</h3>
<p>Самый ценный паттерн. Основная сессия остаётся лёгкой, потому что вся "грязная работа" уходит подагентам.</p>
<p><strong>Что написать Claude Code:</strong></p>
<pre><code>Перед тем как рефакторить модуль оплаты,
запусти отдельного агента для анализа текущей реализации.
Пусть он найдёт все зависимости, проверит тесты,
определит API-контракты. Верни мне только список
того, что нужно изменить, и порядок действий.</code></pre>

<h2>Экономия токенов</h2>

<p>Каждый подагент работает в изолированном контексте. Он не тащит за собой всю историю основной сессии. Основная сессия не раздувается от промежуточных результатов поиска, чтения файлов, проб и ошибок.</p>

<p><strong>Когда делегировать:</strong></p>
<ul>
  <li>Нужно прочитать больше 3-5 файлов для ответа на вопрос</li>
  <li>Задача не зависит от предыдущего контекста сессии</li>
  <li>Можно выполнить несколько задач параллельно</li>
  <li>Результат нужен в сжатом виде, а не в сыром</li>
</ul>

<p><strong>Когда делать в основной сессии:</strong></p>
<ul>
  <li>Правка одного файла, где важен контекст обсуждения</li>
  <li>Итеративная работа: написал, проверил, поправил</li>
  <li>Задача требует знания всего предыдущего разговора</li>
</ul>

<p>Sub-agents. Уникальная возможность Claude Code, которой нет ни в Cursor, ни в Copilot. Используй её осознанно, и каждая сессия будет работать на максимуме контекстного окна.</p>
$body$,
  true,
  ARRAY['sub-agents', 'делегирование', 'оптимизация', 'токены', 'параллельность'],
  50,
  true
);
