import { createClient } from '@supabase/supabase-js'
import { config } from 'dotenv'
import { resolve } from 'path'

config({ path: resolve(import.meta.dirname, '../.env.local') })

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
)

const items = [
  {
    slug: 'mvp-za-odin-den',
    title: 'От идеи до деплоя: строим MVP за один день',
    description: 'Полный пошаговый воркфлоу: от идеи до работающего продукта в интернете за один день. Claude Code как персональный разработчик, Supabase для базы, Vercel для деплоя.',
    type: 'workflow',
    tool: 'claude-code',
    is_premium: true,
    published: true,
    sort_order: 50,
    tags: ['MVP', 'деплой', 'воркфлоу', 'продукт', 'стартап', 'Vercel'],
    content_body: `<h2>Зачем этот воркфлоу</h2>

<p>Раньше путь от идеи до работающего продукта занимал недели. Нужно было писать код, разбираться с деплоем, настраивать базу данных, делать авторизацию. Сейчас с Claude Code этот путь сжимается до одного дня. Не "концепт в Figma", не "лендинг на конструкторе", а полноценное веб-приложение с базой данных, авторизацией и реальной функциональностью.</p>

<p>Этот воркфлоу проведёт вас через весь процесс. От формулировки идеи утром до рабочего продукта вечером. В качестве примера мы соберём SaaS-инструмент для генерации контент-планов: пользователь вводит нишу, получает план на месяц.</p>

<p>Что понадобится: Claude Code (подписка Max или API), аккаунт на Vercel (бесплатный), аккаунт на Supabase (бесплатный), базовое понимание, что такое веб-приложение. Писать код самостоятельно не нужно.</p>

<h2>Этап 1: Утро. Планирование (08:00 - 08:30)</h2>

<h3>Формулировка идеи</h3>

<p>Запишите идею в одном предложении. Не абзац, не страница. Одно предложение, которое отвечает на вопрос: "Что пользователь делает и что получает?"</p>

<p>Наш пример: <strong>"Пользователь вводит свою нишу и целевую аудиторию, а система генерирует контент-план на 30 дней с темами, форматами и хуками для каждого поста."</strong></p>

<h3>Техническое задание через Claude Code</h3>

<p>Откройте терминал, создайте папку проекта и запустите Claude Code. Первый промпт задаёт направление всей работы.</p>

<pre><code>Составь техническое задание для веб-приложения:

Продукт: SaaS-генератор контент-планов.
Пользователь вводит нишу и описание целевой аудитории.
Система генерирует контент-план на 30 дней: тема, формат поста,
крючок (первое предложение), этап воронки (ToFu/MoFu/BoFu).

Стек: Next.js 15 App Router, TypeScript, Tailwind CSS, shadcn/ui,
Supabase (БД + авторизация), OpenAI API для генерации.

Страницы: лендинг, авторизация, дашборд с историей планов,
страница генерации, страница просмотра плана.

Опиши: структуру папок, модели данных, API-роуты, основные компоненты.
Формат: markdown-документ, готовый стать основой CLAUDE.md.</code></pre>

<p>Claude Code выдаст структурированное ТЗ. Проверьте его, скорректируйте, если нужно, и сохраните как основу.</p>

<h3>Создание CLAUDE.md</h3>

<p>CLAUDE.md. Это файл инструкций, который Claude Code читает автоматически при каждом запуске в проекте. Он задаёт контекст: какой стек используется, какие соглашения по коду, какая структура проекта.</p>

<pre><code>Создай файл CLAUDE.md для этого проекта на основе ТЗ выше.
Включи: описание проекта, стек, структуру папок, соглашения
по именованию, ключевые зависимости. Формат: краткий, для
автоматического чтения агентом.</code></pre>

<h3>Инициализация проекта</h3>

<pre><code>/init</code></pre>

<p>Или вручную попросите Claude Code создать проект:</p>

<pre><code>Создай Next.js 15 проект с TypeScript, Tailwind CSS, shadcn/ui.
Установи зависимости: @supabase/supabase-js, @supabase/ssr, openai.
Настрой структуру папок по ТЗ. Инициализируй git.</code></pre>

<p><strong>Время:</strong> 30 минут. К 08:30 у вас есть ТЗ, CLAUDE.md и пустой, но настроенный проект.</p>

<h2>Этап 2: До обеда. Каркас (08:30 - 10:30)</h2>

<h3>Базовые страницы</h3>

<pre><code>Создай лендинг (главную страницу) для ContentPlan AI.
Заголовок: "Контент-план на месяц за 2 минуты"
Подзаголовок: описание ценности для маркетологов и предпринимателей.
Секции: hero, как это работает (3 шага), pricing (free: 1 план/мес,
pro: безлимит за $9/мес), CTA.
Дизайн: минималистичный, тёмная тема, shadcn/ui компоненты.</code></pre>

<p>Claude Code сгенерирует полноценную страницу. Проверьте в браузере (npm run dev), скорректируйте текст или расположение элементов.</p>

<h3>Подключение Supabase</h3>

<pre><code>Настрой подключение к Supabase:
1. Создай lib/supabase/client.ts (клиентский) и lib/supabase/server.ts
   (серверный) клиенты
2. Создай таблицы в Supabase через миграцию:
   - profiles (id, email, plan, created_at)
   - content_plans (id, user_id, niche, audience, plan_data jsonb, created_at)
3. Настрой RLS: пользователь видит только свои планы</code></pre>

<h3>Авторизация</h3>

<pre><code>Реализуй авторизацию через Supabase Auth:
- Страница /login с формой email + magic link
- Middleware для защиты роутов /dashboard/*
- Хук useUser для клиентских компонентов
- Редирект после авторизации на /dashboard</code></pre>

<p><strong>Чекпоинт.</strong> Сделайте коммит. Серьёзно, не пропускайте этот шаг.</p>

<pre><code>Сделай git add и commit с сообщением "feat: base layout,
supabase auth, landing page"</code></pre>

<p><strong>Время:</strong> 2 часа. К 10:30 есть лендинг, авторизация и база данных. Каркас готов.</p>

<h2>Этап 3: После обеда. Ключевая фича (12:00 - 15:00)</h2>

<p>Это главная часть дня. Здесь рождается продукт.</p>

<h3>Генерация контент-плана</h3>

<pre><code>Создай страницу /dashboard/generate:

Форма: два поля (ниша, описание целевой аудитории) + кнопка "Сгенерировать".
При отправке: вызов API-роута /api/generate, который:
1. Принимает niche и audience из формы
2. Отправляет промпт в OpenAI API (gpt-4o)
3. Получает контент-план на 30 дней в JSON-формате
4. Сохраняет результат в таблицу content_plans
5. Редиректит на /dashboard/plans/[id]

Промпт для OpenAI должен генерировать для каждого дня:
- Тема поста
- Формат (текст / карусель / видео / опрос)
- Этап воронки (ToFu / MoFu / BoFu)
- Хук (первое предложение)
- Краткое описание содержания

Показывай loading-состояние во время генерации.
Обработай ошибки: лимит API, сетевые проблемы, невалидный ответ.</code></pre>

<h3>Итерации</h3>

<p>Первая версия будет работать, но сыроватой. Вот промпты для доработки:</p>

<pre><code>Добавь валидацию формы: ниша обязательна (минимум 3 символа),
аудитория обязательна (минимум 10 символов). Покажи ошибки
под полями, не алертом.</code></pre>

<pre><code>Страница просмотра плана /dashboard/plans/[id]:
Таблица с 30 строками. Колонки: день, тема, формат, воронка, хук.
Добавь фильтрацию по этапу воронки и по формату.
Кнопка "Экспорт в CSV".</code></pre>

<pre><code>Сделай мобильную версию. Таблицу на мобильных замени
на карточки. Форма генерации должна занимать всю ширину экрана.
Проверь, что ничего не ломается на ширине 375px.</code></pre>

<h3>Работа с багами</h3>

<p>Баги будут. Это нормально. Ключ к быстрому исправлению: точное описание проблемы.</p>

<p><strong>Плохо:</strong> "Не работает генерация"</p>
<p><strong>Хорошо:</strong></p>

<pre><code>При нажатии на кнопку "Сгенерировать" получаю ошибку в консоли:
"TypeError: Cannot read properties of undefined (reading 'choices')".
Запрос к /api/generate возвращает 200, но тело ответа пустое.
Проверь, правильно ли парсится ответ от OpenAI.</code></pre>

<p>Чем точнее вы опишете: что произошло, что ожидалось, что показывает консоль, тем быстрее Claude Code найдёт решение.</p>

<p><strong>Коммит:</strong></p>

<pre><code>git add -A && git commit -m "feat: content plan generation,
plan view, mobile responsive"</code></pre>

<p><strong>Время:</strong> 3 часа. К 15:00 есть работающий продукт с основной фичей.</p>

<h2>Этап 4: Вечер. Полировка и деплой (15:30 - 17:00)</h2>

<h3>SEO-минимум</h3>

<pre><code>Добавь SEO-основы:
1. Метатеги для всех страниц (title, description, og:image, og:title)
2. Файл sitemap.xml (динамический, через Next.js route handler)
3. Файл robots.txt
4. Компонент OG-картинки через next/og для динамических страниц
5. Favicon и manifest.json</code></pre>

<h3>Деплой на Vercel</h3>

<p>Если у вас ещё нет аккаунта на Vercel, создайте. Деплой через git:</p>

<pre><code>1. Создай репозиторий на GitHub
2. Запуши код: git remote add origin [url] && git push -u origin main
3. В Vercel: Import Project → выбери репозиторий
4. Добавь env-переменные: NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY,
   SUPABASE_SERVICE_ROLE_KEY, OPENAI_API_KEY
5. Deploy</code></pre>

<p>Vercel подхватит Next.js автоматически. Каждый следующий git push запускает новый деплой.</p>

<h3>Подключение домена</h3>

<p>В настройках проекта на Vercel: Settings → Domains → Add. Введите домен, настройте DNS-записи у регистратора. Vercel выдаст SSL-сертификат автоматически.</p>

<h3>Финальная проверка</h3>

<pre><code>Проверь продакшен-версию:
1. Авторизация работает (magic link приходит на email)
2. Генерация плана отрабатывает без ошибок
3. Данные сохраняются в Supabase
4. Мобильная версия выглядит корректно
5. Метатеги отдаются правильно (проверь через curl -I)
6. Нет console.log и дебаг-кода в продакшене</code></pre>

<p><strong>Время:</strong> 1.5 часа. К 17:00 продукт доступен по реальному URL.</p>

<h2>Чеклист запуска</h2>

<p>Перед тем как показать продукт людям, пройдитесь по списку:</p>

<ul>
<li><strong>Работоспособность:</strong> основной сценарий (регистрация → генерация → просмотр) проходит без ошибок</li>
<li><strong>Мобильная версия:</strong> проверена на реальном телефоне, не только в DevTools</li>
<li><strong>Обработка ошибок:</strong> при падении API пользователь видит понятное сообщение, а не белый экран</li>
<li><strong>Скорость:</strong> лендинг загружается за 2-3 секунды на мобильном интернете</li>
<li><strong>Тексты:</strong> нет Lorem ipsum, нет "test" в заголовках, нет дефолтных описаний</li>
<li><strong>Favicon:</strong> не стандартный Next.js треугольник</li>
<li><strong>Env-переменные:</strong> все прокинуты в Vercel, ничего не захардкожено в коде</li>
<li><strong>Приватность:</strong> RLS в Supabase настроен, пользователь не видит чужие данные</li>
</ul>

<h2>Типичные ошибки первого запуска</h2>

<ol>
<li><strong>Перфекционизм.</strong> "Ещё одну фичу, и тогда покажу." Нет. MVP работает. Покажите его людям сегодня.</li>
<li><strong>Игнорирование мобильной версии.</strong> Больше половины трафика придёт с телефонов. Если на мобильном сломано, считайте, что продукта нет.</li>
<li><strong>Забытые env-переменные.</strong> Локально всё работает, на Vercel белый экран. Проверяйте переменные окружения дважды.</li>
<li><strong>Нет обработки ошибок.</strong> OpenAI API может вернуть 429 (лимит) или 500. Без обработки пользователь увидит крашнутую страницу.</li>
<li><strong>Попытка сделать всё самому.</strong> Claude Code пишет код. Вы принимаете продуктовые решения. Не наоборот.</li>
</ol>

<h2>Следующий день: что делать после запуска</h2>

<ol>
<li><strong>Аналитика.</strong> Подключите Vercel Analytics или Plausible. Смотрите: сколько людей доходит до генерации, сколько возвращается на следующий день.</li>
<li><strong>Фидбэк.</strong> Попросите 5-10 человек попробовать продукт. Наблюдайте, где они застревают. Это важнее любых метрик.</li>
<li><strong>Итерации.</strong> На основе фидбэка выберите одну вещь для улучшения. Одну, не пять. Попросите Claude Code реализовать. Задеплойте. Повторите.</li>
</ol>

<p>Один день, один MVP, один деплой. Не идеальный продукт, но работающий. Тот, который можно показать реальным людям и получить реальный фидбэк. А это ценнее любого количества планирования.</p>`
  }
]

async function seed() {
  for (const item of items) {
    const { data, error } = await supabase
      .from('comm_content_items')
      .upsert(item, { onConflict: 'slug' })
      .select('id, slug')
      .single()
    if (error) {
      console.error('Error inserting', item.slug, ':', error.message)
    } else {
      console.log('OK:', data.slug, '→', data.id)
    }
  }
}

seed().catch(console.error)
